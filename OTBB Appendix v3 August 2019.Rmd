---
title: "Opening the Black Box Appendix"
output:
  pdf_document: default
  html_document: default
---

These are the statistical appendices for **Opening the Black Box of International Aid: Understanding Delivery Actors and Democratization** by Caroline Dunton and Jack Hasler.

For questions or comments on these appedices, please contact Jack Hasler at jhasler@gwu.edu.

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE)
```

##Appendix A1: Donor Countries
```{r donors}
#The assumption is that you have loaded the "working" data from the main replication file.
load('./working_8-14.RData')

library(tidyverse)
library(kableExtra)
library(plm)
library(stargazer)
library(countrycode)
library(readr)
library(car)
library(readxl)
library(wbstats)
library(knitr)
library(broom)
library(dotwhisker)
library(sandwich)
library(lmtest)
library(gridExtra)
library(robustHD)

working %>%
  group_by(DonorName,Year) %>%
  add_count() %>%
  summarise(disbursement = sum(total_disbursement, na.rm = TRUE), count = mean(n)) %>%
  ungroup() %>%
  group_by(DonorName) %>%
  summarise(Mean_Aid = round(mean(disbursement, na.rm = TRUE), digits = 2), Min_Recipients = min(count), Max_Recipients = max(count)) %>%
  kable() %>%
  kable_styling(full_width = FALSE, latex_options = c("hold_position", "repeat_header")) %>%
  column_spec(1, width = '10em', bold = T, border_right = T) %>%
  column_spec(2, width = "10em") %>%
  column_spec(3, width = "10em") %>%
  column_spec(4, width = "10em")
```

\pagebreak

##Appendix A2: Recipient Countries

```{r recipients}
#The assumption is that you have loaded the "working" data from the main replication file.

working %>%
  group_by(RecipientName,Year) %>%
  add_count() %>%
  summarise(disbursement = sum(total_disbursement, na.rm = TRUE), count = mean(n)) %>%
  ungroup() %>%
  group_by(RecipientName) %>%
  summarise(Mean_Aid = round(mean(disbursement, na.rm = TRUE), digits = 2), Min_Donors = min(count), Max_Donors = max(count)) %>%
  kable(longtable = TRUE) %>%
  kable_styling(full_width = FALSE, latex_options = c("hold_position", "repeat_header")) %>%
  column_spec(1, width = '10em', bold = T, border_right = T) %>%
  column_spec(2, width = "10em") %>%
  column_spec(3, width = "10em") %>%
  column_spec(4, width = "10em")
```

\pagebreak

##Appendix B1: ECM Model

One of the things you can test for with an error correction model is endogeneity resulting from reverse causality. This is possible if we believe countries are likely to systematically change their method of delivering aid and how much they give based changes in a country's level of democracy. The following ecm model should have coefficients that are 0 for all but the lagged dependent variables. Some are signficantly different from 0, which suggests that some endogeity may be present. Intuitively, this makes sense because aid will be allocated partially based on existing levels of democracy. 

Here we only present the ECM model for Polyarchy model since those results are the most robust, but ECMs for the other Models can be produced upon request.

```{r ecm_model, results='asis'}
library(ecm)

ecm_data <- working %>%
  select(DyadName,lead_year,DonorName,RecipientName,total_disbursement, ngo_total, igo_total, gov_d_total, gov_r_total, corp_total,gdp,urban,pop, v2x_polyarchy, v2x_libdem, v2x_partipdem, fdi_d, fdi_r)



ecm_data <- ecm_data %>%
  arrange(DyadName,lead_year) %>%
  group_by(DyadName) %>%
  mutate(lag_ngo = dplyr::lag(ngo_total, n = 1, default = NA),
         lag_igo = dplyr::lag(igo_total, n = 1, default = NA),
         lag_corp = dplyr::lag(corp_total, n = 1, default = NA),
         lag_gov_d = dplyr::lag(gov_d_total, n = 1, default = NA),
         lag_gov_r = dplyr::lag(gov_r_total, n = 1, default = NA),
         lag_poly = dplyr::lag(v2x_polyarchy, n = 1, default = NA),
         lag_lib = dplyr::lag(v2x_libdem, n = 1, default = NA),
         lag_partip = dplyr::lag(v2x_partipdem, n = 1, default = NA),
         lag_gdp = dplyr::lag(gdp, n = 1, default = NA),
         lag_pop = dplyr::lag(pop, n = 1, default = NA),
         lag_urban = dplyr::lag(urban, n = 1, default = NA),
         lag_fdi_d = dplyr::lag(fdi_r, n = 1, default = NA),
         lag_fdi_r = dplyr::lag(fdi_d, n = 1, default = NA)
         ) %>%
  mutate(diff_gdp = gdp - lag_gdp,
         diff_pop = pop - lag_pop,
         diff_urban = urban - lag_urban,
         diff_fdi_d = urban - lag_fdi_d,
         diff_fdi_r = urban - lag_fdi_r) %>%
  mutate(diff_poly2 = v2x_polyarchy - lag_poly,
         diff_lib = v2x_libdem - lag_lib,
         diff_partip = v2x_partipdem - lag_partip) %>%
  ungroup()

ecm_mod1 <- plm(ngo_total ~ lag_ngo + lag_poly + lag_gdp + lag_pop + lag_urban + lag_fdi_d + lag_fdi_r + diff_poly2 + diff_gdp + diff_pop + diff_urban + diff_fdi_d + diff_fdi_r,model = 'within',index = c('DyadName'), data = ecm_data)
ecm_mod2 <- plm(igo_total ~ lag_igo + lag_poly + lag_gdp + lag_pop + lag_urban + lag_fdi_d + lag_fdi_r + diff_poly2 + diff_gdp + diff_pop + diff_urban + diff_fdi_d + diff_fdi_r,model = 'within',index = c('DyadName'), data = ecm_data)
ecm_mod3 <- plm(corp_total ~ lag_corp + lag_poly + lag_gdp + lag_pop + lag_urban + lag_fdi_d + lag_fdi_r + diff_poly2 + diff_gdp + diff_pop + diff_urban + diff_fdi_d + diff_fdi_r,model = 'within',index = c('DyadName'), data = ecm_data)
ecm_mod4 <- plm(gov_d_total ~ lag_gov_d + lag_poly + lag_gdp + lag_pop + lag_urban + lag_fdi_d + lag_fdi_r + diff_poly2 + diff_gdp + diff_pop + diff_urban + diff_fdi_d + diff_fdi_r,model = 'within',index = c('DyadName'), data = ecm_data)
ecm_mod5 <- plm(gov_r_total ~ lag_gov_r + lag_poly + lag_gdp + lag_pop + lag_urban + lag_fdi_d + lag_fdi_r + diff_poly2 + diff_gdp + diff_pop + diff_urban + diff_fdi_d + diff_fdi_r,model = 'within',index = c('DyadName'), data = ecm_data)

stargazer(ecm_mod1, ecm_mod2, ecm_mod3, ecm_mod4, ecm_mod5, colnames = FALSE, dep.var.labels = c('NGO','IGO','CORP','DONOR','RECIP'), model.numbers = FALSE,font.size = 'small', column.sep.width = '1pt', table.placement = 'H', header = FALSE)

all_ecm_mods <- rbind(tidy(ecm_mod1) %>% mutate(model = 'ECM NGO'),tidy(ecm_mod2) %>% mutate(model = 'ECM IGO'),tidy(ecm_mod3) %>% mutate(model = 'ECM Corp'),tidy(ecm_mod4) %>% mutate(model = 'ECM Donor Gov'),tidy(ecm_mod5) %>% mutate(model = 'ECM Recipient Gov')) %>% filter(term!='lag_ngo'&term!='lag_igo'&term!='lag_corp'&term!='lag_gov_r'&term!='lag_gov_d')

dwplot(all_ecm_mods)

rm(ecm_data)
rm(ecm_mod1)
rm(ecm_mod2)
rm(ecm_mod3)
rm(ecm_mod4)
rm(ecm_mod5)
```

\pagebreak

##Appendix C1: Other Types of Democracy Measures

For space reasons, the egalitarian and deliberative measures in VDem were not included in the main results, but they are presented here. They provide even stronger support for our theory.

```{r other_dvs, results='asis', message = FALSE, warning = FALSE}
ind.vars.total <- c('gov_d_total','gov_r_total','ngo_total','igo_total','corp_total','other_total')

ind.vars.total.controlled <- c('gov_d_total','gov_r_total','ngo_total','igo_total','corp_total','other_total','log(gdp)','urban','log(pop)','fdi_d','fdi_r')


mod.poly <- plm(as.formula(paste('I(v2x_polyarchy)', paste(c(ind.vars.total.controlled, "lagpoly"), collapse = '+'),sep='~')), model = 'within',index = c('DyadName'), data = working)
mod.lib <- plm(as.formula(paste('I(v2x_libdem)', paste(c(ind.vars.total.controlled, "laglib"), collapse = '+'),sep='~')), model = 'within',index = c('DyadName'), data = working)
mod.partip <- plm(as.formula(paste('I(v2x_partipdem)', paste(c(ind.vars.total.controlled, "lagpartip"), collapse = '+'),sep='~')), model = 'within',index = c('DyadName'), data = working)
mod.egal <- plm(as.formula(paste('I(v2x_egaldem)', paste(c(ind.vars.total.controlled, "lagegal"), collapse = '+'),sep='~')), model = 'within',index = c('DyadName'), data = working)
mod.delib <- plm(as.formula(paste('I(v2x_delibdem)', paste(c(ind.vars.total.controlled, "lagdelib"), collapse = '+'),sep='~')), model = 'within',index = c('DyadName'), data = working)

stargazer(mod.poly,mod.lib,mod.partip,mod.delib, mod.egal, colnames = FALSE,dep.var.labels = c('Electoral','Liberal','Participatory','Deliberative','Egalitarian'), title = 'All VDem Results', model.numbers = FALSE, covariate.labels = c('Donor Gov','Target Gov','NGO','IGO','Corporation','Other','log(GDP)','Urban','log(Population)'), font.size = 'small', column.sep.width = '1pt', table.placement = 'H', header = FALSE)

mod.poly2 <- tidy(mod.poly) %>%
  filter(term == "gov_d_total" | term == 'gov_r_total' | term == 'ngo_total' | term == 'igo_total' | term == 'corp_total' | term == 'other_total') %>%
  mutate(model = "Polarchy")
mod.lib2 <- tidy(mod.lib) %>%
  filter(term == "gov_d_total" | term == 'gov_r_total' | term == 'ngo_total' | term == 'igo_total' | term == 'corp_total' | term == 'other_total') %>%
  mutate(model = "Liberal")
mod.partip2 <- tidy(mod.partip) %>%
  filter(term == "gov_d_total" | term == 'gov_r_total' | term == 'ngo_total' | term == 'igo_total' | term == 'corp_total' | term == 'other_total') %>%
  mutate(model = "Participatory")
mod.egal2 <- tidy(mod.egal) %>%
  filter(term == "gov_d_total" | term == 'gov_r_total' | term == 'ngo_total' | term == 'igo_total' | term == 'corp_total' | term == 'other_total') %>%
  mutate(model = "Egalitarian")
mod.delib2 <- tidy(mod.delib) %>%
  filter(term == "gov_d_total" | term == 'gov_r_total' | term == 'ngo_total' | term == 'igo_total' | term == 'corp_total' | term == 'other_total') %>%
  mutate(model = "Deliberative")


all_mods <- rbind(mod.poly2, mod.lib2, mod.partip2, mod.egal2, mod.delib2)

dwplot(all_mods) %>%
  relabel_predictors(c('gov_d_total' = "Donor Gov",                       
                      'gov_r_total' = "Target Gov", 
                      'ngo_total' = "NGO", 
                      'igo_total' = "IGO", 
                      'corp_total' = "Corporations", 
                      'other_total' = "Other")) +
     theme_bw() + xlab("Coefficient Estimate") + ylab("") +
     geom_vline(xintercept = 0, colour = "grey60", linetype = 2) +
     ggtitle("Main Results") + 
     scale_color_discrete(name = "Dem Variable", labels = c('Electoral','Liberal','Participatory', 'Egalitarian', 'Deliberative')) 

coef_tests <- function(model){
tests <- c(
  "Rec Gov v NGO",
  "Rec Gov v IGO",
  "Rec Gov v Corp",
  "Donor Gov v NGO",
  "Donor Gov v IGO",
  "Donor Gov v Corp",
  "NGO v Corp",
  "IGO v Corp"
  )
chi2 <- c(
  linearHypothesis(model, "gov_r_total = ngo_total")$Chisq[2],
  linearHypothesis(model, "gov_r_total = igo_total")$Chisq[2],
  linearHypothesis(model, "gov_r_total = corp_total")$Chisq[2],
  linearHypothesis(model, "gov_d_total = ngo_total")$Chisq[2],
  linearHypothesis(model, "gov_d_total = igo_total")$Chisq[2],
  linearHypothesis(model, "gov_d_total = corp_total")$Chisq[2],
  linearHypothesis(model, "ngo_total = corp_total")$Chisq[2],
  linearHypothesis(model, "igo_total = corp_total")$Chisq[2]
  )
pvals <- c(
  linearHypothesis(model, "gov_r_total = ngo_total")$`Pr(>Chisq)`[2],
  linearHypothesis(model, "gov_r_total = igo_total")$`Pr(>Chisq)`[2],
  linearHypothesis(model, "gov_r_total = corp_total")$`Pr(>Chisq)`[2],
  linearHypothesis(model, "gov_d_total = ngo_total")$`Pr(>Chisq)`[2],
  linearHypothesis(model, "gov_d_total = igo_total")$`Pr(>Chisq)`[2],
  linearHypothesis(model, "gov_d_total = corp_total")$`Pr(>Chisq)`[2],
  linearHypothesis(model, "ngo_total = corp_total")$`Pr(>Chisq)`[2],
  linearHypothesis(model, "igo_total = corp_total")$`Pr(>Chisq)`[2]
  )
tmp <- data.frame(tests, chi2, pvals)
tmp$adjustedholm <- p.adjust(tmp$pvals, method = 'holm')
tmp$adjustedby <- p.adjust(tmp$pvals, method = 'BY')
tmp
}

tests.egal <- coef_tests(mod.egal)
tests.delib <- coef_tests(mod.delib)
tests.poly <- coef_tests(mod.poly)
tests.lib <- coef_tests(mod.lib)
tests.partip <- coef_tests(mod.partip)
tests.egal$Model <- "Egalitarian"
tests.delib$Model <- "Deliberative"
tests.poly$Model <- "Electoral"
tests.lib$Model <- "Liberal"
tests.partip$Model <- "Participatory"

all.tests <- rbind(tests.poly, tests.lib, tests.partip, tests.egal,tests.delib)


p1 <- ggplot(all.tests, aes(pvals, tests, color = Model)) + labs(title = "Coefficient Raw Tests") + geom_vline(xintercept=.05) + geom_point() + xlim(0,1)
p2 <- ggplot(all.tests, aes(adjustedholm, tests, color = Model)) + geom_vline(xintercept=.05) + geom_point() + labs(title = "Coefficient Holm Corrected Tests") + xlim(0,1)

grid.arrange(p1,p2)

stargazer(tests.poly, summary = FALSE, header = FALSE)
stargazer(tests.lib, summary = FALSE, header = FALSE)
stargazer(tests.partip, summary = FALSE, header = FALSE)
stargazer(tests.egal, summary = FALSE, header = FALSE)
stargazer(tests.delib, summary = FALSE, header = FALSE)

rm(mod.poly)
rm(mod.lib)
rm(mod.partip)
rm(mod.delib)
rm(mod.egal)
rm(mod.poly2)
rm(mod.lib2)
rm(mod.partip2)
rm(mod.delib2)
rm(mod.egal2)

```

\pagebreak

##Appendix C2: Freedom House

As stated in the paper, VDem was chosen for its comprehensive appraoch and clear rating guidelines while polity was chosen for its ubiquity in the discipline. Freedom House can be somewhat more opaque in its ratings which are based on expert answers to questions rather than a cohesive overview. That said, they are still a useful robustness check to make sure our results are not dependent on a particular rating of democracy. 

The scales for civil liberties, political rights and status come from Freedom House inverted relative to the other two and the other measures used in our paper (a lower score means more democratic). For consistency and ease of interpretation, we invert them back. As such, all but the rule of law model suppo our argument to some degree. This is not surprising as our coding as "democratic purpose" excludes some types of aid that might be targetted at rule of law, such as aid to police forces and prisons.

These results are all extrememly small because of the minimal amount of variation found in most freedom house scores, which means that most of each dependent variable is explained by including it's lagged form as an independent variable.
```{r fh, results='asis', warning=FALSE, message=FALSE}
working_fh <- working %>%
  filter(!is.na(e_fh_cl)&!is.na(e_fh_pr)&!is.na(e_fh_rol)&!is.na(e_fh_status))

working_fh$e_fh_cl <- standardize(working_fh$e_fh_cl)*(-1)
working_fh$e_fh_pr <- standardize(working_fh$e_fh_pr)*(-1)
working_fh$e_fh_rol <- standardize(working_fh$e_fh_rol)

working_fh$e_fh_status_ch <- working_fh$e_fh_status
working_fh$e_fh_status[working_fh$e_fh_status_ch == "NF"] <- 0
working_fh$e_fh_status[working_fh$e_fh_status_ch == "PF"] <- 1
working_fh$e_fh_status[working_fh$e_fh_status_ch == "F"] <- 2
working_fh$e_fh_status <- standardize(as.numeric(working_fh$e_fh_status))

working_fh <- working_fh %>%
  group_by(DyadName) %>%
  arrange(Year) %>%
  mutate(lag_cl = lag(e_fh_cl),lag_pr = lag(e_fh_pr),lag_rol = lag(e_fh_rol),lag_status = lag(e_fh_status))
working_fh <- working_fh %>%
  filter(!is.na(lag_cl) & !is.na(lag_pr) & !is.na(lag_rol) & !is.na(lag_status))


mod.cl <- plm(as.formula(paste('I(e_fh_cl)', paste(c(ind.vars.total.controlled,"lag_cl"), collapse = '+'),sep='~')), model = 'within',index = c('DyadName'), data = working_fh)
mod.pr <- plm(as.formula(paste('I(e_fh_pr)', paste(c(ind.vars.total.controlled,"lag_pr"), collapse = '+'),sep='~')), model = 'within',index = c('DyadName'), data = working_fh)
mod.rol <- plm(as.formula(paste('I(e_fh_rol)', paste(c(ind.vars.total.controlled,"lag_rol"), collapse = '+'),sep='~')), model = 'within',index = c('DyadName'), data = working_fh)
mod.status <- plm(as.formula(paste('I(e_fh_status)', paste(c(ind.vars.total.controlled,"lag_status"), collapse = '+'),sep='~')), model = 'within',index = c('DyadName'), data = working_fh)

stargazer(mod.cl,mod.pr,mod.rol,mod.status, colnames = FALSE,dep.var.labels = c('Civil Liberties','Political Rights','Rule of Law','Status'), title = 'All Freedom House Results', model.numbers = FALSE, covariate.labels = c('Donor Gov','Target Gov','NGO','IGO','Corporation','Other','log(GDP)','Urban','log(Population)'), font.size = 'small', column.sep.width = '1pt', table.placement = 'H', header = FALSE, omit.stat = "f")

mod.cl2 <- tidy(mod.cl) %>%
  filter(term == "gov_d_total" | term == 'gov_r_total' | term == 'ngo_total' | term == 'igo_total' | term == 'corp_total' | term == 'other_total') %>%
  mutate(model = "Civil Liberties")
mod.pr2 <- tidy(mod.pr) %>%
  filter(term == "gov_d_total" | term == 'gov_r_total' | term == 'ngo_total' | term == 'igo_total' | term == 'corp_total' | term == 'other_total') %>%
  mutate(model = "Political Rights")
mod.rol2 <- tidy(mod.rol) %>%
  filter(term == "gov_d_total" | term == 'gov_r_total' | term == 'ngo_total' | term == 'igo_total' | term == 'corp_total' | term == 'other_total') %>%
  mutate(model = "Rule of Law")
mod.status2 <- tidy(mod.status) %>%
  filter(term == "gov_d_total" | term == 'gov_r_total' | term == 'ngo_total' | term == 'igo_total' | term == 'corp_total' | term == 'other_total') %>%
  mutate(model = "Status")

all_mods <- rbind(mod.cl2, mod.pr2, mod.rol2, mod.status2)

dwplot(all_mods) %>%
  relabel_predictors(c('gov_d_total' = "Donor Gov",                       
                      'gov_r_total' = "Target Gov", 
                      'ngo_total' = "NGO", 
                      'igo_total' = "IGO", 
                      'corp_total' = "Corporations", 
                      'other_total' = "Other")) +
     theme_bw() + xlab("Coefficient Estimate") + ylab("") +
     geom_vline(xintercept = 0, colour = "grey60", linetype = 2) +
     ggtitle("Main Results") + 
     scale_color_discrete(name = "Dem Variable", labels = c('Civil Liberties','Political Rights', 'Rule of Law', 'Status')) 

tests.cl <- coef_tests(mod.cl)
tests.pr <- coef_tests(mod.pr)
tests.rol <- coef_tests(mod.rol)
tests.status <- coef_tests(mod.status)
tests.cl$Model <- "Civil Liberties"
tests.pr$Model <- "Political Rights"
tests.rol$Model <- "Rule of Law"
tests.status$Model <- "Status"

all.tests <- rbind(tests.cl, tests.pr, tests.rol ,tests.status)


p1 <- ggplot(all.tests, aes(pvals, tests, color = Model)) + labs(title = "Coefficient Raw Tests") + geom_vline(xintercept=.05) + geom_point() + xlim(0,1)
p2 <- ggplot(all.tests, aes(adjustedholm, tests, color = Model)) + geom_vline(xintercept=.05) + geom_point() + labs(title = "Coefficient Holm Corrected Tests") + xlim(0,1)

grid.arrange(p1,p2)

stargazer(tests.cl, summary = FALSE, header = FALSE)
stargazer(tests.pr, summary = FALSE, header = FALSE)
stargazer(tests.rol, summary = FALSE, header = FALSE)
stargazer(tests.status, summary = FALSE, header = FALSE)

rm(working_fh)
rm(mod.cl)
rm(mod.pr)
rm(mod.rol)
rm(mod.status)
rm(mod.cl2)
rm(mod.pr2)
rm(mod.rol2)
rm(mod.status2)

```

\clearpage

##Appendix C3: Polity

```{r polity, results='asis', warning=FALSE, message=FALSE}
working_polity <- working %>%
  filter(!is.na(e_p_polity))

working_polity$polity2 <- standardize(working_polity$e_p_polity)
working_polity$lagpolity <- standardize(working_polity$lagpolity)


working_polity <- working_polity %>%
  filter(!is.na(lagpolity))


mod.polity <- plm(as.formula(paste('I(polity2)', paste(c(ind.vars.total.controlled,"lagpolity"), collapse = '+'),sep='~')), model = 'within',index = c('DyadName'), data = working_polity)

stargazer(mod.polity, colnames = FALSE,dep.var.labels = c('Polity'), title = 'All Polity Results', model.numbers = FALSE, covariate.labels = c('Donor Gov','Target Gov','NGO','IGO','Corporation','Other','log(GDP)','Urban','log(Population)'), font.size = 'small', column.sep.width = '1pt', table.placement = 'H', header = FALSE, omit.stat = "f")

all_mods <- tidy(mod.polity) %>%
  filter(term == "gov_d_total" | term == 'gov_r_total' | term == 'ngo_total' | term == 'igo_total' | term == 'corp_total' | term == 'other_total') %>%
  mutate(model = "Polity")
dwplot(all_mods) %>%
  relabel_predictors(c('gov_d_total' = "Donor Gov",                       
                      'gov_r_total' = "Target Gov", 
                      'ngo_total' = "NGO", 
                      'igo_total' = "IGO", 
                      'corp_total' = "Corporations", 
                      'other_total' = "Other")) +
     theme_bw() + xlab("Coefficient Estimate") + ylab("") +
     geom_vline(xintercept = 0, colour = "grey60", linetype = 2) +
     ggtitle("Main Results") + 
     scale_color_discrete(name = "Dem Variable", labels = c('Polity')) 
tests.polity <- coef_tests(mod.polity)
tests.polity$Model <- "Polity"
all.tests <- rbind(tests.polity)
p1 <- ggplot(all.tests, aes(pvals, tests, color = Model)) + labs(title = "Coefficient Raw Tests") + geom_vline(xintercept=.05) + geom_point() + xlim(0,1)
p2 <- ggplot(all.tests, aes(adjustedholm, tests, color = Model)) + geom_vline(xintercept=.05) + geom_point() + labs(title = "Coefficient Holm Corrected Tests") + xlim(0,1)
grid.arrange(p1,p2)
stargazer(tests.polity, summary = FALSE, header = FALSE)
rm(working_polity)
```

\clearpage

##Appendix C4: Including all types of donors

These results include all donors in the original CRS data, not just country donors. The most significant inclusion is organizations that use their own money as opposed to being delivery method for money from a country. Since these organizations will almost always use themselves, these results are biased in favor on the organizations and our hypotheses. 

A remarkable result here is that all types of actors, even recipient governments positively increase democracy except for corporations, which still decrease it. NGOs and IGOs, however, are still better than those governments at delivering democratization outcomes.

```{r import_codes, message = FALSE}
#Importing channel codes
modified_crs_channel_codes <- read_delim("new_channel_codes.csv",",", escape_double = FALSE, trim_ws = TRUE)

#selecting and renaming as necessary
channel_codes <- modified_crs_channel_codes %>%
  select(`Channel ID`, ch_type,ch_identity) %>%
  rename(code = `Channel ID`)
rm(modified_crs_channel_codes)
#turning into factors
channel_codes$ch_type <- as.factor(channel_codes$ch_type)
channel_codes$ch_identity <- as.factor(channel_codes$ch_identity)

#Importing dem purpose codes. Right now these are the "loose" codings. More narrow options exist in dempurposecodes,csv
dempurposecodes <- read_csv("dempurposecodes_medium.csv")
dempurposecodes <- dempurposecodes %>%
  filter(dem_purpose==1)%>%
  select(PurposeCode)
```


```{r dyad_crs_program}
#This is a function that takes a by year crs_data set, a set of channel codes, and a set of dem purpose codes. It removes unneeded variables and filters out NAs. It then recodes projects with our channel codes which are broader than the original ones. It also gets rid of observations that are not in our set of dem_purpose codes. Finally it reshapes the data a bit to poop out a data frame with observations that are RECIPIENT-YEAR. Variables include the total amount of aid overall and by each channel type. Percentages are also caculated by each channel type.

crs_reshape_dy <- function(crs_data, ch_codes, dempurposecodes){
  
  #This chunk selects necessary variables (donor,recipient, channel, purpose and disbursement) and filters
  #out unwanted donors, recipients and obs with missing channel codes.
  crs_data <- crs_data %>%
    select(Year,RecipientCode,RecipientName,DonorCode,DonorName,
           usd_disbursement,ChannelCode,PurposeCode) %>%
    na.omit() %>%
    filter(!(RecipientCode %in% c(88,89,189,289,489,689,389,380,298,619,798,889,789,679,498,9998,589))) %>%
    filter(PurposeCode %in% dempurposecodes$PurposeCode) %>%
    filter(!is.na(ChannelCode))
  #merge with channelcodes
  crs_data <- merge(crs_data, channel_codes, by.x = 'ChannelCode', by.y = 'code', all.x = TRUE)
  #counts and aid totals for all types
  crs_data <- crs_data %>%
    group_by(Year,DonorCode,RecipientCode) %>%
    add_count(sort = TRUE) %>%
    mutate(total_disbursement = sum(usd_disbursement, na.rm = TRUE)) %>%
    ungroup()
  
  crs_data$ch_type2 = ifelse(crs_data$ch_type == 'government'&crs_data$ch_identity == 'donor','government_donor', ifelse(crs_data$ch_type == 'government'&crs_data$ch_identity == 'recipient','government_recipient', ifelse(crs_data$ch_type == 'government'&(crs_data$ch_identity == 'other'|crs_data$ch_identity == 'thirdparty'),'government_other',ifelse(crs_data$ch_type == 'publicprivate'|crs_data$ch_type == 'corporation','corporation',ifelse(crs_data$ch_type == 'network'|crs_data$ch_type == 'edu'|crs_data$ch_type=='ngo','ngo', ifelse(crs_data$ch_type == 'igo', 'igo', ifelse(crs_data$ch_type == 'other', 'other',crs_data$ch_type)))))))
  crs_data$ch_type <- crs_data$ch_type2


  
  #This giant block splits it up by type and subtype-identity. 
  crs_data2 <- crs_data %>%
    group_by(Year,RecipientCode,DonorCode,ch_type) %>%
    mutate(
      gov_d_total = ifelse(ch_type == 'government_donor',sum(usd_disbursement,na.rm = TRUE),0),
      gov_r_total = ifelse(ch_type == 'government_recipient',sum(usd_disbursement,na.rm = TRUE),0),
      gov_o_total = ifelse(ch_type == 'government_other',sum(usd_disbursement,na.rm = TRUE),0),
      gov_total = ifelse(ch_type == 'government',sum(usd_disbursement, na.rm = TRUE),0),
      corp_total = ifelse(ch_type == 'corporation',sum(usd_disbursement,na.rm = TRUE),0),
      ngo_total = ifelse(ch_type == 'ngo',sum(usd_disbursement,na.rm = TRUE),0),
      igo_total = ifelse(ch_type == 'igo',sum(usd_disbursement,na.rm = TRUE),0),
      other_total = ifelse(ch_type == 'other',sum(usd_disbursement,na.rm = TRUE),0)
    ) %>%
    ungroup() %>%
    group_by(Year,DonorCode,RecipientCode) %>%
    select(Year,RecipientCode,RecipientName,DonorCode,DonorName,n,total_disbursement,gov_total,gov_d_total,gov_r_total,gov_o_total,corp_total,ngo_total,igo_total,other_total) %>%
    mutate(
      gov_d_total = max(round(gov_d_total,6), na.rm = TRUE),
      gov_r_total = max(round(gov_r_total,6), na.rm = TRUE),
      gov_o_total = max(round(gov_o_total,6), na.rm = TRUE),
      gov_total = max(round(gov_d_total+gov_r_total+gov_o_total,6), na.rm = TRUE),
      corp_total = max(round(corp_total,6), na.rm = TRUE),
      ngo_total = max(round(ngo_total,6), na.rm = TRUE),
      igo_total = max(round(igo_total,6), na.rm = TRUE),
      other_total = max(round(other_total,6), na.rm = TRUE)
    ) %>%
    unique() %>%
    ungroup() 
  #Return the data frame.
  crs_data2
}
```

```{r dyad_import_crs_data, message=FALSE}
#This chunk imports and merges all of the yearly CRS data according to the above function.
#vector of the file name years. Early ones are grouped together. 1973-94 is omitted as it serves as the base case below.
years <- c('1995-99','2000-01','2002-03','2004-05','2006','2007','2008','2009','2010','2011','2012','2013','2014','2015','2016','2017')

#importing and running crs_by_types on the base case
load(file = './CRS 1973-94 data.RData')
crs_by_types <- crs_reshape_dy(crs_tmp,channel_codes,dempurposecodes)

#importing, reshaping and appending each of the CRS data files.
for (i in years){
  filepath = paste0('./CRS ',i,' data.RData')
  load(file = filepath)
  tmp_df <- crs_reshape_dy(crs_tmp, channel_codes,dempurposecodes)
  crs_by_types <- rbind(crs_by_types, tmp_df)
}

```

```{r dyad_import_and_merge_controls}
crs_by_types$RecipientName <- ifelse(crs_by_types$RecipientCode == 247, 'Cote dIvoire',crs_by_types$RecipientName)
crs_by_types$new.code <- countrycode(crs_by_types$RecipientName, origin = 'country.name', destination = 'iso3n')
crs_by_types$new.code <- ifelse(crs_by_types$RecipientCode == 247, 384, crs_by_types$new.code) #Cote d'Ivoire
crs_by_types$new.code <- ifelse(crs_by_types$RecipientCode == 860, 583, crs_by_types$new.code) #Federated States of Micronesia
#crs_by_types$new.code <- ifelse(crs_by_types$RecipientCode == 63, 345, crs_by_types$new.code) #Serbia

working <- crs_by_types %>%
  filter(!is.na(Year)&!is.na(new.code)) %>%
  filter(!is.infinite(ngo_total)|!is.infinite(gov_d_total)|!is.infinite(gov_r_total)|!is.infinite(gov_o_total)|!is.infinite(corp_total)|!is.infinite(igo_total)|!is.infinite(other_total))
rm(crs_by_types)

working$DonorCode <- countrycode(working$DonorName, origin = "country.name", destination = "iso3n")
working$RecipientCode <- countrycode(working$RecipientName, origin = "country.name", destination = "iso3n")
working$RecipientCode[is.na(working$RecipientCode)] <- 583

working$lead_year <- working$Year + 1

#Use this code to import and reformat vdem variables from scratch.
#vdem <- read_csv("Country_Year_V-Dem_Extended_CSV_v8/Country_Year_V-Dem_Extended_CSV_v8/V-Dem-CY+Others-v8.csv")
#vdem <- vdem %>%
#  select(country_name,year,COWcode,v2x_polyarchy,v2x_libdem,v2x_partipdem,v2x_delibdem,v2x_egaldem,
#         e_fh_cl,e_fh_pair,e_fh_pr,e_fh_rol,e_fh_status,e_p_polity,e_coups,e_democracy_trans) %>%
#  filter(year>2004)
#vdem$RecipientCode <- countrycode(vdem$country_name, origin = 'country.name', destination = 'iso3n')
#save(vdem, file = "./vdem.RData")

load('./vdem.RData')
vdem$e_p_polity[vdem$e_p_polity <= -11] <-NA

working <- merge(working, vdem, by.x = c('lead_year','RecipientCode'),by.y = c('year','RecipientCode'))

lagvdem <- vdem %>%
  select(year,RecipientCode,v2x_polyarchy, v2x_libdem, v2x_partipdem, v2x_delibdem, v2x_egaldem) %>%
  rename(lagpoly = v2x_polyarchy, laglib = v2x_libdem, lagpartip = v2x_partipdem,lagdelib = v2x_delibdem,lagegal = v2x_egaldem)

working <- merge(working, lagvdem, by.x = c('Year','RecipientCode'),by.y = c('year','RecipientCode'))


working$DyadName <- paste(working$DonorName,working$RecipientName,sep = '-')


##Pulling in some basic controls from the World Bank
gdp <- wb(country = 'all', indicator = 'NY.GDP.PCAP.CD', startdate = '2003', enddate = '2018') %>%
  rename(gdp = value, year = date) %>%
  select(iso3c, year, gdp, country)
urban <- wb(country = 'all', indicator = 'SP.URB.TOTL.IN.ZS', startdate = '2003', enddate = '2018') %>%
  rename(urban = value, year = date) %>%
  select(iso3c,year,urban)
pop <- wb(country = 'all', indicator = 'SP.POP.TOTL', startdate = '2003', enddate = '2018') %>%
  rename(pop = value, year = date) %>%
  select(iso3c,year,pop)
fdi_r <- wb(country = 'all', indicator = 'BX.KLT.DINV.WD.GD.ZS', startdate = '2003', enddate = '2018') %>%
  rename(fdi_r = value, year = date) %>%
  select(iso3c,year,fdi_r)
fdi_d <- wb(country = 'all', indicator = 'BM.KLT.DINV.WD.GD.ZS', startdate = '2003', enddate = '2018') %>%
  rename(fdi_d = value, year = date) %>%
  mutate(iso3n = countrycode(iso3c,origin = "iso3c",destination = "iso3n")) %>%
  select(iso3n,year,fdi_d)


controls <- merge(fdi_r,merge(gdp,merge(urban, pop, by = c('iso3c','year')), by = c('iso3c','year')), by = c('iso3c','year'))

controls$RecipientCode <- countrycode(controls$iso3c, origin = 'iso3c', destination = 'iso3n')
controls$RecipientCode <- ifelse(controls$iso3c == 'SRB',345,controls$RecipientCode)

#Note: All missingness from this command is fine. It is the wb grouped categories (e.g. 'world') and can be dropped.

controls <- controls %>%
  select(RecipientCode,year,gdp,urban,pop,fdi_r) %>%
  filter(!is.na(RecipientCode))

working <- merge(working, controls, by.x = c('Year','RecipientCode'), by.y = c('year','RecipientCode'), all.x = TRUE)

working <- merge(working,fdi_d,by.x = c("DonorCode","Year"), by.y = c("iso3n","year"))


working <- working %>%
  filter(!is.na(DyadName)) %>% #If everything is done correctly, this should remove no obs.
  filter(COWcode!=99999) %>%
  unique()
```

```{r, message=FALSE, results='asis', warning=FALSE}
working <- working %>%
  filter(!is.na(v2x_polyarchy)&!is.na(v2x_libdem)&!is.na(v2x_partipdem)&!is.na(gov_d_total)&!is.na(gov_r_total)&!is.na(gov_o_total)&!is.na(other_total)&!is.na(ngo_total)&!is.na(igo_total)&!is.na(corp_total)&!is.na(gdp)&!is.na(urban)&!is.na(pop)&!is.na(other_total)&!is.na(lead_year)&!is.na(DyadName))

library(robustHD)
working$v2x_polyarchy <- standardize(working$v2x_polyarchy)
working$v2x_libdem <- standardize(working$v2x_libdem)
working$v2x_partipdem <- standardize(working$v2x_partipdem)
working$v2x_delibdem <- standardize(working$v2x_delibdem)
working$v2x_egaldem <- standardize(working$v2x_egaldem)

working$lagpoly <- standardize(working$lagpoly)
working$laglib <- standardize(working$laglib)
working$lagpartip <- standardize(working$lagpartip)
working$lagdelib <- standardize(working$lagdelib)
working$lagegal <- standardize(working$lagegal)

working$other_total <- log(working$other_total+working$gov_o_total+1)
working$gov_d_total <- log(working$gov_d_total+1)
working$gov_r_total <- log(working$gov_r_total+1)
working$gov_o_total <- log(working$gov_o_total+1)
working$ngo_total <- log(working$ngo_total+1)
working$igo_total <- log(working$igo_total+1)
working$corp_total <- log(working$corp_total+1)

ind.vars.total <- c('gov_d_total','gov_r_total','ngo_total','igo_total','corp_total','other_total')

ind.vars.total.controlled <- c('gov_d_total','gov_r_total','ngo_total','igo_total','corp_total','other_total','log(gdp)','urban','log(pop)','fdi_d','fdi_r')

mod.poly <- plm(as.formula(paste('I(v2x_polyarchy)', paste(c(ind.vars.total.controlled, "lagpoly"), collapse = '+'),sep='~')), model = 'within',index = c('DyadName'), data = working)
mod.lib <- plm(as.formula(paste('I(v2x_libdem)', paste(c(ind.vars.total.controlled, "laglib"), collapse = '+'),sep='~')), model = 'within',index = c('DyadName'), data = working)
mod.partip <- plm(as.formula(paste('I(v2x_partipdem)', paste(c(ind.vars.total.controlled, "lagpartip"), collapse = '+'),sep='~')), model = 'within',index = c('DyadName'), data = working)

stargazer(mod.poly,mod.lib,mod.partip, colnames = FALSE,dep.var.labels = c('Electoral','Liberal','Participatory'), title = 'Main Results', model.numbers = FALSE, covariate.labels = c('Donor Gov','Target Gov','NGO','IGO','Corporation','Other','log(GDP)','Urban','log(Population)'), font.size = 'small', column.sep.width = '1pt', header = FALSE, omit.stat = "f")

mod.poly2 <- tidy(mod.poly) %>%
  filter(term == "gov_d_total" | term == 'gov_r_total' | term == 'ngo_total' | term == 'igo_total' | term == 'corp_total' | term == 'other_total') %>%
  mutate(model = "Polarchy")
mod.lib2 <- tidy(mod.lib) %>%
  filter(term == "gov_d_total" | term == 'gov_r_total' | term == 'ngo_total' | term == 'igo_total' | term == 'corp_total' | term == 'other_total') %>%
  mutate(model = "Liberal")
mod.partip2 <- tidy(mod.partip) %>%
  filter(term == "gov_d_total" | term == 'gov_r_total' | term == 'ngo_total' | term == 'igo_total' | term == 'corp_total' | term == 'other_total') %>%
  mutate(model = "Participatory")


all_mods <- rbind(mod.poly2, mod.lib2, mod.partip2)

dwplot(all_mods) %>%
  relabel_predictors(c('gov_d_total' = "Donor Gov",                       
                      'gov_r_total' = "Recipient Gov", 
                      'ngo_total' = "NGO", 
                      'igo_total' = "IGO", 
                      'corp_total' = "Corporations", 
                      'other_total' = "Other")) +
     theme_bw() + xlab("Coefficient Estimate") + ylab("") +
     geom_vline(xintercept = 0, colour = "grey60", linetype = 2) +
     ggtitle("Main Results") + 
     scale_color_discrete(name = "Dem Variable", labels = c('Electoral','Liberal','Participatory')) 

tests.poly <- coef_tests(mod.poly)
tests.lib <- coef_tests(mod.lib)
tests.partip <- coef_tests(mod.partip)
tests.poly$Model <- "Electoral"
tests.lib$Model <- "Liberal"
tests.partip$Model <- "Participatory"

all.tests <- rbind(tests.poly, tests.lib, tests.partip)


p1 <- ggplot(all.tests, aes(pvals, tests, color = Model)) + labs(title = "Coefficient Raw Tests") + geom_vline(xintercept=.05) + geom_point() + xlim(0,1)
p2 <- ggplot(all.tests, aes(adjustedholm, tests, color = Model)) + geom_vline(xintercept=.05) + geom_point() + labs(title = "Coefficient Holm Corrected Tests") + xlim(0,1)

grid.arrange(p1,p2)


stargazer(coef_tests(mod.poly), summary = FALSE, header = FALSE)
stargazer(coef_tests(mod.lib), summary = FALSE, header = FALSE)
stargazer(coef_tests(mod.partip), summary = FALSE, header = FALSE)
rm(mod.poly)
rm(mod.lib)
rm(mod.partip)
```

\clearpage

##Appendix C5: Analysis by Recipient-Year

Aggregating by recipient pools together variation that might exist on the donor level. By using the dyad level, however, we may be artifically increasing the importance of recipients that receive aid from numerous sources. As a robustness check, we aggregate by the recipient in the models below. The results generally also support our argument, that less fungible sources like NGOs and IGOs increase democratization more.


```{r, message = FALSE}
#Importing channel codes
modified_crs_channel_codes <- read_delim("new_channel_codes.csv",",", escape_double = FALSE, trim_ws = TRUE)

#selecting and renaming as necessary
channel_codes <- modified_crs_channel_codes %>%
  select(`Channel ID`, ch_type,ch_identity) %>%
  rename(code = `Channel ID`)
rm(modified_crs_channel_codes)
#turning into factors
channel_codes$ch_type <- as.factor(channel_codes$ch_type)
channel_codes$ch_identity <- as.factor(channel_codes$ch_identity)

#Importing dem purpose codes. Right now these are the "loose" codings. More narrow options exist in dempurposecodes,csv
dempurposecodes <- read_csv("dempurposecodes_medium.csv")
dempurposecodes <- dempurposecodes %>%
  filter(dem_purpose==1)%>%
  select(PurposeCode)
```


```{r}
#This is a function that takes a by year crs_data set, a set of channel codes, and a set of dem purpose codes. It removes unneeded variables and filters out NAs. It then recodes projects with our channel codes which are broader than the original ones. It also gets rid of observations that are not in our set of dem_purpose codes. Finally it reshapes the data a bit to poop out a data frame with observations that are RECIPIENT-YEAR. Variables include the total amount of aid overall and by each channel type. Percentages are also caculated by each channel type.

crs_reshape_dy <- function(crs_data, ch_codes, dempurposecodes){
  
  #This chunk selects necessary variables (donor,recipient, channel, purpose and disbursement) and filters
  #out unwanted donors, recipients and obs with missing channel codes.
  crs_data <- crs_data %>%
    select(Year,RecipientCode,RecipientName,DonorCode,DonorName,
           usd_disbursement,ChannelCode,PurposeCode) %>%
    na.omit() %>%
    filter(!(RecipientCode %in% c(88,89,189,289,489,689,389,380,298,619,798,889,789,679,498,9998,589))) %>%
    filter(PurposeCode %in% dempurposecodes$PurposeCode) %>%
    filter(DonorCode %in% c(1,2,3,4,5,6,7,8,9,10,11,12,13,18,20,21,22,40,50,61,68,69,75,76,301,302,701,742,801,820,82,83,84,358,55,546)) %>%
    filter(!is.na(ChannelCode))
  #merge with channelcodes
  crs_data <- merge(crs_data, channel_codes, by.x = 'ChannelCode', by.y = 'code', all.x = TRUE)
  #counts and aid totals for all types
  crs_data <- crs_data %>%
    group_by(Year,RecipientCode) %>%
    add_count(sort = TRUE) %>%
    mutate(total_disbursement = sum(usd_disbursement, na.rm = TRUE)) %>%
    ungroup()
  
  crs_data$ch_type2 = ifelse(crs_data$ch_type == 'government'&crs_data$ch_identity == 'donor','government_donor', ifelse(crs_data$ch_type == 'government'&crs_data$ch_identity == 'recipient','government_recipient', ifelse(crs_data$ch_type == 'government'&(crs_data$ch_identity == 'other'|crs_data$ch_identity == 'thirdparty'),'government_other',ifelse(crs_data$ch_type == 'publicprivate'|crs_data$ch_type == 'corporation','corporation',ifelse(crs_data$ch_type == 'network'|crs_data$ch_type == 'edu'|crs_data$ch_type=='ngo','ngo', ifelse(crs_data$ch_type == 'igo', 'igo', ifelse(crs_data$ch_type == 'other', 'other',crs_data$ch_type)))))))
  crs_data$ch_type <- crs_data$ch_type2


  
  #This giant block splits it up by type and subtype-identity. 
  crs_data2 <- crs_data %>%
    group_by(Year,RecipientCode,ch_type) %>%
    mutate(
      gov_d_total = ifelse(ch_type == 'government_donor',sum(usd_disbursement,na.rm = TRUE),0),
      gov_r_total = ifelse(ch_type == 'government_recipient',sum(usd_disbursement,na.rm = TRUE),0),
      gov_o_total = ifelse(ch_type == 'government_other',sum(usd_disbursement,na.rm = TRUE),0),
      gov_total = ifelse(ch_type == 'government',sum(usd_disbursement, na.rm = TRUE),0),
      corp_total = ifelse(ch_type == 'corporation',sum(usd_disbursement,na.rm = TRUE),0),
      ngo_total = ifelse(ch_type == 'ngo',sum(usd_disbursement,na.rm = TRUE),0),
      igo_total = ifelse(ch_type == 'igo',sum(usd_disbursement,na.rm = TRUE),0),
      other_total = ifelse(ch_type == 'other',sum(usd_disbursement,na.rm = TRUE),0)
    ) %>%
    ungroup() %>%
    group_by(Year,RecipientCode) %>%
    select(Year,RecipientCode,RecipientName,n,total_disbursement,gov_total,gov_d_total,gov_r_total,gov_o_total,corp_total,ngo_total,igo_total,other_total) %>%
    mutate(
      gov_d_total = max(round(gov_d_total,6), na.rm = TRUE),
      gov_r_total = max(round(gov_r_total,6), na.rm = TRUE),
      gov_o_total = max(round(gov_o_total,6), na.rm = TRUE),
      gov_total = max(round(gov_d_total+gov_r_total+gov_o_total,6), na.rm = TRUE),
      corp_total = max(round(corp_total,6), na.rm = TRUE),
      ngo_total = max(round(ngo_total,6), na.rm = TRUE),
      igo_total = max(round(igo_total,6), na.rm = TRUE),
      other_total = max(round(other_total,6), na.rm = TRUE)
    ) %>%
    unique() %>%
    ungroup() 
  #Return the data frame.
  crs_data2
}
```

```{r, message=FALSE}
#This chunk imports and merges all of the yearly CRS data according to the above function.
#vector of the file name years. Early ones are grouped together. 1973-94 is omitted as it serves as the base case below.
years <- c('1995-99','2000-01','2002-03','2004-05','2006','2007','2008','2009','2010','2011','2012','2013','2014','2015','2016','2017')

#importing and running crs_by_types on the base case
load(file = './CRS 1973-94 data.RData')
crs_by_types <- crs_reshape_dy(crs_tmp,channel_codes,dempurposecodes)

#importing, reshaping and appending each of the CRS data files.
for (i in years){
  filepath = paste0('./CRS ',i,' data.RData')
  load(file = filepath)
  tmp_df <- crs_reshape_dy(crs_tmp, channel_codes,dempurposecodes)
  crs_by_types <- rbind(crs_by_types, tmp_df)
}

```


```{r}
crs_by_types$RecipientName <- ifelse(crs_by_types$RecipientCode == 247, 'Cote dIvoire',crs_by_types$RecipientName)
crs_by_types$new.code <- countrycode(crs_by_types$RecipientName, origin = 'country.name', destination = 'iso3n')
crs_by_types$new.code <- ifelse(crs_by_types$RecipientCode == 247, 384, crs_by_types$new.code) #Cote d'Ivoire
crs_by_types$new.code <- ifelse(crs_by_types$RecipientCode == 860, 583, crs_by_types$new.code) #Federated States of Micronesia
#crs_by_types$new.code <- ifelse(crs_by_types$RecipientCode == 63, 345, crs_by_types$new.code) #Serbia

working <- crs_by_types %>%
  filter(!is.na(Year)&!is.na(new.code)) %>%
  filter(!is.infinite(ngo_total)|!is.infinite(gov_d_total)|!is.infinite(gov_r_total)|!is.infinite(gov_o_total)|!is.infinite(corp_total)|!is.infinite(igo_total)|!is.infinite(other_total))

working$RecipientCode <- countrycode(working$RecipientName, origin = "country.name", destination = "iso3n")
working$RecipientCode[is.na(working$RecipientCode)] <- 583

working$lead_year <- working$Year + 1

working <- merge(working, vdem, by.x = c('lead_year','RecipientCode'),by.y = c('year','RecipientCode'))
working <- merge(working, lagvdem, by.x = c('Year','RecipientCode'),by.y = c('year','RecipientCode'))

working <- merge(working, controls, by.x = c('Year','RecipientCode'), by.y = c('year','RecipientCode'), all.x = TRUE)
working <- working %>%
  filter(!is.na(RecipientName)) %>% #If everything is done correctly, this should remove no obs.
  filter(COWcode!=99999) %>%
  unique()
```

```{r enhanced_scatter, include = FALSE, eval=FALSE}

yr16 <- working %>%
  filter(Year == 2016) %>%
  rename(GDP = gdp) %>%
  mutate(Region = countrycode(RecipientName, origin = 'country.name', destination = 'continent'))

ggplot(yr16,aes(gov_d_total/total_disbursement,v2x_polyarchy)) +
     geom_point(aes(size=GDP, color = Region)) + geom_text_repel(aes(label=RecipientName),hjust=-.25, vjust=0, size = 3) +
  ylab("VDem Democracy (Polyarchy)") + xlab("Aid Delivered By Donor Government / Total Aid")

ggplot(yr16,aes((ngo_total+igo_total)/total_disbursement,v2x_polyarchy)) +
+     geom_point(aes(size=pop)) + geom_text(aes(label=RecipientName),hjust=-.5, vjust=0, size = 2)


```

```{r, message=FALSE, results='asis', warning=FALSE}
working <- working %>%
  filter(!is.na(v2x_polyarchy)&!is.na(v2x_libdem)&!is.na(v2x_partipdem)&!is.na(gov_d_total)&!is.na(gov_r_total)&!is.na(gov_o_total)&!is.na(other_total)&!is.na(ngo_total)&!is.na(igo_total)&!is.na(corp_total)&!is.na(gdp)&!is.na(urban)&!is.na(pop)&!is.na(other_total)&!is.na(lead_year))

working$v2x_polyarchy <- standardize(working$v2x_polyarchy)
working$v2x_libdem <- standardize(working$v2x_libdem)
working$v2x_partipdem <- standardize(working$v2x_partipdem)
working$v2x_delibdem <- standardize(working$v2x_delibdem)
working$v2x_egaldem <- standardize(working$v2x_egaldem)

working$lagpoly <- standardize(working$lagpoly)
working$laglib <- standardize(working$laglib)
working$lagpartip <- standardize(working$lagpartip)
working$lagdelib <- standardize(working$lagdelib)
working$lagegal <- standardize(working$lagegal)

working$other_total <- log(working$other_total+working$gov_o_total+1)
working$gov_d_total <- log(working$gov_d_total+1)
working$gov_r_total <- log(working$gov_r_total+1)
working$gov_o_total <- log(working$gov_o_total+1)
working$ngo_total <- log(working$ngo_total+1)
working$igo_total <- log(working$igo_total+1)
working$corp_total <- log(working$corp_total+1)

ind.vars.total.controlled <- c('gov_d_total','gov_r_total','ngo_total','igo_total','corp_total','other_total','log(gdp)','urban','log(pop)','fdi_r')



mod.poly <- plm(as.formula(paste('I(v2x_polyarchy)', paste(c(ind.vars.total.controlled, "lagpoly"), collapse = '+'),sep='~')), model = 'within',index = c('RecipientName'), data = working)
mod.lib <- plm(as.formula(paste('I(v2x_libdem)', paste(c(ind.vars.total.controlled, "laglib"), collapse = '+'),sep='~')), model = 'within',index = c('RecipientName'), data = working)
mod.partip <- plm(as.formula(paste('I(v2x_partipdem)', paste(c(ind.vars.total.controlled, "lagpartip"), collapse = '+'),sep='~')), model = 'within',index = c('RecipientName'), data = working)

stargazer(mod.poly,mod.lib,mod.partip, colnames = FALSE,dep.var.labels = c('Electoral','Liberal','Participatory'), title = 'Main Results', model.numbers = FALSE, covariate.labels = c('Donor Gov','Target Gov','NGO','IGO','Corporation','Other','log(GDP)','Urban','log(Population)'), font.size = 'small', column.sep.width = '1pt', header = FALSE, omit.stat = "f")

mod.poly2 <- tidy(mod.poly) %>%
  filter(term == "gov_d_total" | term == 'gov_r_total' | term == 'ngo_total' | term == 'igo_total' | term == 'corp_total' | term == 'other_total') %>%
  mutate(model = "Polarchy")
mod.lib2 <- tidy(mod.lib) %>%
  filter(term == "gov_d_total" | term == 'gov_r_total' | term == 'ngo_total' | term == 'igo_total' | term == 'corp_total' | term == 'other_total') %>%
  mutate(model = "Liberal")
mod.partip2 <- tidy(mod.partip) %>%
  filter(term == "gov_d_total" | term == 'gov_r_total' | term == 'ngo_total' | term == 'igo_total' | term == 'corp_total' | term == 'other_total') %>%
  mutate(model = "Participatory")

all_mods <- rbind(mod.poly2, mod.lib2, mod.partip2)

dwplot(all_mods) %>%
  relabel_predictors(c('gov_d_total' = "Donor Gov",                       
                      'gov_r_total' = "Target Gov", 
                      'ngo_total' = "NGO", 
                      'igo_total' = "IGO", 
                      'corp_total' = "Corporations", 
                      'other_total' = "Other")) +
     theme_bw() + xlab("Coefficient Estimate") + ylab("") +
     geom_vline(xintercept = 0, colour = "grey60", linetype = 2) +
     ggtitle("Main Results") + 
     scale_color_discrete(name = "Dem Variable", labels = c('Electoral','Liberal','Participatory')) 

tests.poly <- coef_tests(mod.poly)
tests.lib <- coef_tests(mod.lib)
tests.partip <- coef_tests(mod.partip)
tests.poly$Model <- "Electoral"
tests.lib$Model <- "Liberal"
tests.partip$Model <- "Participatory"

all.tests <- rbind(tests.poly, tests.lib, tests.partip)


p1 <- ggplot(all.tests, aes(pvals, tests, color = Model)) + labs(title = "Coefficient Raw Tests") + geom_vline(xintercept=.05) + geom_point() + xlim(0,1)
p2 <- ggplot(all.tests, aes(adjustedholm, tests, color = Model)) + geom_vline(xintercept=.05) + geom_point() + labs(title = "Coefficient Holm Corrected Tests") + xlim(0,1)

grid.arrange(p1,p2)


stargazer(coef_tests(mod.poly), summary = FALSE, header = FALSE)
stargazer(coef_tests(mod.lib), summary = FALSE, header = FALSE)
stargazer(coef_tests(mod.partip), summary = FALSE, header = FALSE)
rm(mod.poly)
rm(mod.lib)
rm(mod.partip)
```

\clearpage

##Appendix C6: Effect of All Aid on Democratization
In this appendix, we consider all ODA on democratization outcomes, not just aid intended to democratize a country. It still excludes military and other aid excluded from the OECD's ODA defintion, but includes a large amount of aid intended to assist developing countries in other ways. 

The results are rather suprising. NGOs and IGOs are still better than corporations, but they have a slightly negative effect on democracy. Donor governments have similar results, but the recipient governments are associated with an increase in democracy. More work is needed to understand why this is. The non-democratization aid included here comes from a wide variety of sectors, including a lot of aid aimed at infrastructure assistance. 


```{r, message = FALSE}
#Importing channel codes
modified_crs_channel_codes <- read_delim("new_channel_codes.csv",",", escape_double = FALSE, trim_ws = TRUE)

#selecting and renaming as necessary
channel_codes <- modified_crs_channel_codes %>%
  select(`Channel ID`, ch_type,ch_identity) %>%
  rename(code = `Channel ID`)
rm(modified_crs_channel_codes)
#turning into factors
channel_codes$ch_type <- as.factor(channel_codes$ch_type)
channel_codes$ch_identity <- as.factor(channel_codes$ch_identity)

#Importing dem purpose codes. Right now these are the "loose" codings. More narrow options exist in dempurposecodes,csv
dempurposecodes <- read_csv("dempurposecodes_medium.csv")
dempurposecodes <- dempurposecodes %>%
  filter(dem_purpose==1)%>%
  select(PurposeCode)
```


```{r}
#This is a function that takes a by year crs_data set, a set of channel codes, and a set of dem purpose codes. It removes unneeded variables and filters out NAs. It then recodes projects with our channel codes which are broader than the original ones. It also gets rid of observations that are not in our set of dem_purpose codes. Finally it reshapes the data a bit to poop out a data frame with observations that are RECIPIENT-YEAR. Variables include the total amount of aid overall and by each channel type. Percentages are also caculated by each channel type.

crs_reshape_dy <- function(crs_data, ch_codes, dempurposecodes){
  
  #This chunk selects necessary variables (donor,recipient, channel, purpose and disbursement) and filters
  #out unwanted donors, recipients and obs with missing channel codes.
  crs_data <- crs_data %>%
    select(Year,RecipientCode,RecipientName,DonorCode,DonorName,
           usd_disbursement,ChannelCode,PurposeCode) %>%
    na.omit() %>%
    filter(!(RecipientCode %in% c(88,89,189,289,489,689,389,380,298,619,798,889,789,679,498,9998,589))) %>%
    filter(DonorCode %in% c(1,2,3,4,5,6,7,8,9,10,11,12,13,18,20,21,22,40,50,61,68,69,75,76,301,302,701,742,801,820,82,83,84,358,55,546)) %>%
    filter(!is.na(ChannelCode))
  #merge with channelcodes
  crs_data <- merge(crs_data, channel_codes, by.x = 'ChannelCode', by.y = 'code', all.x = TRUE)
  #counts and aid totals for all types
  crs_data <- crs_data %>%
    group_by(Year,DonorCode,RecipientCode) %>%
    add_count(sort = TRUE) %>%
    mutate(total_disbursement = sum(usd_disbursement, na.rm = TRUE)) %>%
    ungroup()
  
  crs_data$ch_type2 = ifelse(crs_data$ch_type == 'government'&crs_data$ch_identity == 'donor','government_donor', ifelse(crs_data$ch_type == 'government'&crs_data$ch_identity == 'recipient','government_recipient', ifelse(crs_data$ch_type == 'government'&(crs_data$ch_identity == 'other'|crs_data$ch_identity == 'thirdparty'),'government_other',ifelse(crs_data$ch_type == 'publicprivate'|crs_data$ch_type == 'corporation','corporation',ifelse(crs_data$ch_type == 'network'|crs_data$ch_type == 'edu'|crs_data$ch_type=='ngo','ngo', ifelse(crs_data$ch_type == 'igo', 'igo', ifelse(crs_data$ch_type == 'other', 'other',crs_data$ch_type)))))))
  crs_data$ch_type <- crs_data$ch_type2


  
  #This giant block splits it up by type and subtype-identity. 
  crs_data2 <- crs_data %>%
    group_by(Year,RecipientCode,DonorCode,ch_type) %>%
    mutate(
      gov_d_total = ifelse(ch_type == 'government_donor',sum(usd_disbursement,na.rm = TRUE),0),
      gov_r_total = ifelse(ch_type == 'government_recipient',sum(usd_disbursement,na.rm = TRUE),0),
      gov_o_total = ifelse(ch_type == 'government_other',sum(usd_disbursement,na.rm = TRUE),0),
      gov_total = ifelse(ch_type == 'government',sum(usd_disbursement, na.rm = TRUE),0),
      corp_total = ifelse(ch_type == 'corporation',sum(usd_disbursement,na.rm = TRUE),0),
      ngo_total = ifelse(ch_type == 'ngo',sum(usd_disbursement,na.rm = TRUE),0),
      igo_total = ifelse(ch_type == 'igo',sum(usd_disbursement,na.rm = TRUE),0),
      other_total = ifelse(ch_type == 'other',sum(usd_disbursement,na.rm = TRUE),0)
    ) %>%
    ungroup()
  #Return the data frame.
  crs_data2
}
```

```{r, message=FALSE}
#This chunk imports and merges all of the yearly CRS data according to the above function.
#vector of the file name years. Early ones are grouped together. 1973-94 is omitted as it serves as the base case below.
years <- c('1995-99','2000-01','2002-03','2004-05','2006','2007','2008','2009','2010','2011','2012','2013','2014','2015','2016','2017')

#importing and running crs_by_types on the base case
load(file = './CRS 1973-94 data.RData')
crs_by_types <- crs_reshape_dy(crs_tmp,channel_codes,dempurposecodes)

#importing, reshaping and appending each of the CRS data files.
for (i in years){
  filepath = paste0('./CRS ',i,' data.RData')
  load(file = filepath)
  tmp_df <- crs_reshape_dy(crs_tmp, channel_codes,dempurposecodes)
  crs_by_types <- rbind(crs_by_types, tmp_df)
}

```


```{r}
crs_by_types$RecipientName <- ifelse(crs_by_types$RecipientCode == 247, 'Cote dIvoire',crs_by_types$RecipientName)
crs_by_types$new.code <- countrycode(crs_by_types$RecipientName, origin = 'country.name', destination = 'iso3n')
crs_by_types$new.code <- ifelse(crs_by_types$RecipientCode == 247, 384, crs_by_types$new.code) #Cote d'Ivoire
crs_by_types$new.code <- ifelse(crs_by_types$RecipientCode == 860, 583, crs_by_types$new.code) #Federated States of Micronesia
#crs_by_types$new.code <- ifelse(crs_by_types$RecipientCode == 63, 345, crs_by_types$new.code) #Serbia

working <- crs_by_types %>%
  filter(!is.na(Year)&!is.na(new.code)) %>%
  filter(!is.infinite(ngo_total)|!is.infinite(gov_d_total)|!is.infinite(gov_r_total)|!is.infinite(gov_o_total)|!is.infinite(corp_total)|!is.infinite(igo_total)|!is.infinite(other_total))

working$DonorCode <- countrycode(working$DonorName, origin = "country.name", destination = "iso3n")
working$RecipientCode <- countrycode(working$RecipientName, origin = "country.name", destination = "iso3n")
working$RecipientCode[is.na(working$RecipientCode)] <- 583

working$lead_year <- working$Year + 1

working <- merge(working, vdem, by.x = c('lead_year','RecipientCode'),by.y = c('year','RecipientCode'))
working <- merge(working, lagvdem, by.x = c('Year','RecipientCode'),by.y = c('year','RecipientCode'))
working$DyadName <- paste(working$DonorName,working$RecipientName,sep = '-')
working <- merge(working, controls, by.x = c('Year','RecipientCode'), by.y = c('year','RecipientCode'), all.x = TRUE)

working <- merge(working,fdi_d,by.x = c("DonorCode","Year"), by.y = c("iso3n","year"))
working <- working %>%
  filter(!is.na(DyadName)) %>% #If everything is done correctly, this should remove no obs.
  filter(COWcode!=99999) %>%
  unique()
```

```{r, message=FALSE, results='asis', warning=FALSE}
working <- working %>%
  filter(!is.na(v2x_polyarchy)&!is.na(v2x_libdem)&!is.na(v2x_partipdem)&!is.na(gov_d_total)&!is.na(gov_r_total)&!is.na(gov_o_total)&!is.na(other_total)&!is.na(ngo_total)&!is.na(igo_total)&!is.na(corp_total)&!is.na(gdp)&!is.na(urban)&!is.na(pop)&!is.na(other_total)&!is.na(lead_year)&!is.na(DyadName))



library(robustHD)
working$v2x_polyarchy <- standardize(working$v2x_polyarchy)
working$v2x_libdem <- standardize(working$v2x_libdem)
working$v2x_partipdem <- standardize(working$v2x_partipdem)
working$v2x_delibdem <- standardize(working$v2x_delibdem)
working$v2x_egaldem <- standardize(working$v2x_egaldem)

working$lagpoly <- standardize(working$lagpoly)
working$laglib <- standardize(working$laglib)
working$lagpartip <- standardize(working$lagpartip)
working$lagdelib <- standardize(working$lagdelib)
working$lagegal <- standardize(working$lagegal)

working$other_total <- log(working$other_total+working$gov_o_total+1)
working$gov_d_total <- log(working$gov_d_total+1)
working$gov_r_total <- log(working$gov_r_total+1)
working$gov_o_total <- log(working$gov_o_total+1)
working$ngo_total <- log(working$ngo_total+1)
working$igo_total <- log(working$igo_total+1)
working$corp_total <- log(working$corp_total+1)

ind.vars.total <- c('gov_d_total','gov_r_total','ngo_total','igo_total','corp_total','other_total')

ind.vars.total.controlled <- c('gov_d_total','gov_r_total','ngo_total','igo_total','corp_total','other_total','log(gdp)','urban','log(pop)','fdi_d','fdi_r')



mod.poly <- plm(as.formula(paste('I(v2x_polyarchy)', paste(c(ind.vars.total.controlled, "lagpoly"), collapse = '+'),sep='~')), model = 'within',index = c('DyadName'), data = working)
mod.lib <- plm(as.formula(paste('I(v2x_libdem)', paste(c(ind.vars.total.controlled, "laglib"), collapse = '+'),sep='~')), model = 'within',index = c('DyadName'), data = working)
mod.partip <- plm(as.formula(paste('I(v2x_partipdem)', paste(c(ind.vars.total.controlled, "lagpartip"), collapse = '+'),sep='~')), model = 'within',index = c('DyadName'), data = working)


stargazer(mod.poly,mod.lib,mod.partip, colnames = FALSE,dep.var.labels = c('Electoral','Liberal','Participatory'), title = 'Main Results', model.numbers = FALSE, covariate.labels = c('Donor Gov','Target Gov','NGO','IGO','Corporation','Other','log(GDP)','Urban','log(Population)'), font.size = 'small', column.sep.width = '1pt', header = FALSE, omit.stat = "f")


mod.poly2 <- tidy(mod.poly) %>%
  filter(term == "gov_d_total" | term == 'gov_r_total' | term == 'ngo_total' | term == 'igo_total' | term == 'corp_total' | term == 'other_total') %>%
  mutate(model = "Polarchy")
mod.lib2 <- tidy(mod.lib) %>%
  filter(term == "gov_d_total" | term == 'gov_r_total' | term == 'ngo_total' | term == 'igo_total' | term == 'corp_total' | term == 'other_total') %>%
  mutate(model = "Liberal")
mod.partip2 <- tidy(mod.partip) %>%
  filter(term == "gov_d_total" | term == 'gov_r_total' | term == 'ngo_total' | term == 'igo_total' | term == 'corp_total' | term == 'other_total') %>%
  mutate(model = "Participatory")


all_mods <- rbind(mod.poly2, mod.lib2, mod.partip2)

dwplot(all_mods) %>%
  relabel_predictors(c('gov_d_total' = "Donor Gov",                       
                      'gov_r_total' = "Target Gov", 
                      'ngo_total' = "NGO", 
                      'igo_total' = "IGO", 
                      'corp_total' = "Corporations", 
                      'other_total' = "Other")) +
     theme_bw() + xlab("Coefficient Estimate") + ylab("") +
     geom_vline(xintercept = 0, colour = "grey60", linetype = 2) +
     ggtitle("Main Results") + 
     scale_color_discrete(name = "Dem Variable", labels = c('Electoral','Liberal','Participatory')) 

tests.poly <- coef_tests(mod.poly)
tests.lib <- coef_tests(mod.lib)
tests.partip <- coef_tests(mod.partip)
tests.poly$Model <- "Electoral"
tests.lib$Model <- "Liberal"
tests.partip$Model <- "Participatory"

all.tests <- rbind(tests.poly, tests.lib, tests.partip)


p1 <- ggplot(all.tests, aes(pvals, tests, color = Model)) + labs(title = "Coefficient Raw Tests") + geom_vline(xintercept=.05) + geom_point() + xlim(0,1)
p2 <- ggplot(all.tests, aes(adjustedholm, tests, color = Model)) + geom_vline(xintercept=.05) + geom_point() + labs(title = "Coefficient Holm Corrected Tests") + xlim(0,1)

grid.arrange(p1,p2)

stargazer(coef_tests(mod.poly), summary = FALSE, header = FALSE)
stargazer(coef_tests(mod.lib), summary = FALSE, header = FALSE)
stargazer(coef_tests(mod.partip), summary = FALSE, header = FALSE)
```

\clearpage

##Appendix C7: Effect of Broader Dem Aid Coding on Democratization

```{r, message = FALSE}
#Importing channel codes
modified_crs_channel_codes <- read_delim("new_channel_codes.csv",",", escape_double = FALSE, trim_ws = TRUE)

#selecting and renaming as necessary
channel_codes <- modified_crs_channel_codes %>%
  select(`Channel ID`, ch_type,ch_identity) %>%
  rename(code = `Channel ID`)
rm(modified_crs_channel_codes)
#turning into factors
channel_codes$ch_type <- as.factor(channel_codes$ch_type)
channel_codes$ch_identity <- as.factor(channel_codes$ch_identity)

#Importing dem purpose codes. Right now these are the "loose" codings. More narrow options exist in dempurposecodes,csv
dempurposecodes <- read_csv("dempurposecodes_medium.csv")
dempurposecodes <- dempurposecodes %>%
  filter(dem_purpose==1)%>%
  select(PurposeCode)
```


```{r}
#This is a function that takes a by year crs_data set, a set of channel codes, and a set of dem purpose codes. It removes unneeded variables and filters out NAs. It then recodes projects with our channel codes which are broader than the original ones. It also gets rid of observations that are not in our set of dem_purpose codes. Finally it reshapes the data a bit to poop out a data frame with observations that are RECIPIENT-YEAR. Variables include the total amount of aid overall and by each channel type. Percentages are also caculated by each channel type.

crs_reshape_dy <- function(crs_data, ch_codes, dempurposecodes){
  
  #This chunk selects necessary variables (donor,recipient, channel, purpose and disbursement) and filters
  #out unwanted donors, recipients and obs with missing channel codes.
  crs_data <- crs_data %>%
    select(Year,RecipientCode,RecipientName,DonorCode,DonorName,
           usd_disbursement,ChannelCode,PurposeCode) %>%
    na.omit() %>%
    filter(!(RecipientCode %in% c(88,89,189,289,489,689,389,380,298,619,798,889,789,679,498,9998,589))) %>%
    filter(PurposeCode %in% dempurposecodes$PurposeCode) %>%
    filter(DonorCode %in% c(1,2,3,4,5,6,7,8,9,10,11,12,13,18,20,21,22,40,50,61,68,69,75,76,301,302,701,742,801,820,82,83,84,358,55,546)) %>%
    filter(!is.na(ChannelCode))
  #merge with channelcodes
  crs_data <- merge(crs_data, channel_codes, by.x = 'ChannelCode', by.y = 'code', all.x = TRUE)
  #counts and aid totals for all types
  crs_data <- crs_data %>%
    group_by(Year,DonorCode,RecipientCode) %>%
    add_count(sort = TRUE) %>%
    mutate(total_disbursement = sum(usd_disbursement, na.rm = TRUE)) %>%
    ungroup()
  
  crs_data$ch_type2 = ifelse(crs_data$ch_type == 'government'&crs_data$ch_identity == 'donor','government_donor', ifelse(crs_data$ch_type == 'government'&crs_data$ch_identity == 'recipient','government_recipient', ifelse(crs_data$ch_type == 'government'&(crs_data$ch_identity == 'other'|crs_data$ch_identity == 'thirdparty'),'government_other',ifelse(crs_data$ch_type == 'publicprivate'|crs_data$ch_type == 'corporation','corporation',ifelse(crs_data$ch_type == 'network'|crs_data$ch_type == 'edu'|crs_data$ch_type=='ngo','ngo', ifelse(crs_data$ch_type == 'igo', 'igo', ifelse(crs_data$ch_type == 'other', 'other',crs_data$ch_type)))))))
  crs_data$ch_type <- crs_data$ch_type2
  
  #This giant block splits it up by type and subtype-identity. 
  crs_data2 <- crs_data %>%
    group_by(Year,RecipientCode,DonorCode,ch_type) %>%
    mutate(
      gov_d_total = ifelse(ch_type == 'government_donor',sum(usd_disbursement,na.rm = TRUE),0),
      gov_r_total = ifelse(ch_type == 'government_recipient',sum(usd_disbursement,na.rm = TRUE),0),
      gov_o_total = ifelse(ch_type == 'government_other',sum(usd_disbursement,na.rm = TRUE),0),
      gov_total = ifelse(ch_type == 'government',sum(usd_disbursement, na.rm = TRUE),0),
      corp_total = ifelse(ch_type == 'corporation',sum(usd_disbursement,na.rm = TRUE),0),
      ngo_total = ifelse(ch_type == 'ngo',sum(usd_disbursement,na.rm = TRUE),0),
      igo_total = ifelse(ch_type == 'igo',sum(usd_disbursement,na.rm = TRUE),0),
      other_total = ifelse(ch_type == 'other',sum(usd_disbursement,na.rm = TRUE),0)
    ) %>%
    ungroup() %>%
    group_by(Year,DonorCode,RecipientCode) %>%
    select(Year,RecipientCode,RecipientName,DonorCode,DonorName,n,total_disbursement,gov_total,gov_d_total,gov_r_total,gov_o_total,corp_total,ngo_total,igo_total,other_total) %>%
    mutate(
      gov_d_total = max(round(gov_d_total,6), na.rm = TRUE),
      gov_r_total = max(round(gov_r_total,6), na.rm = TRUE),
      gov_o_total = max(round(gov_o_total,6), na.rm = TRUE),
      gov_total = max(round(gov_d_total+gov_r_total+gov_o_total,6), na.rm = TRUE),
      corp_total = max(round(corp_total,6), na.rm = TRUE),
      ngo_total = max(round(ngo_total,6), na.rm = TRUE),
      igo_total = max(round(igo_total,6), na.rm = TRUE),
      other_total = max(round(other_total,6), na.rm = TRUE)
    ) %>%
    unique() %>%
    ungroup() 
  #Return the data frame.
  crs_data2
}
```

```{r, message=FALSE}
#This chunk imports and merges all of the yearly CRS data according to the above function.
#vector of the file name years. Early ones are grouped together. 1973-94 is omitted as it serves as the base case below.
years <- c('1995-99','2000-01','2002-03','2004-05','2006','2007','2008','2009','2010','2011','2012','2013','2014','2015','2016','2017')

#importing and running crs_by_types on the base case
load(file = './CRS 1973-94 data.RData')
crs_by_types <- crs_reshape_dy(crs_tmp,channel_codes,dempurposecodes)

#importing, reshaping and appending each of the CRS data files.
for (i in years){
  filepath = paste0('./CRS ',i,' data.RData')
  load(file = filepath)
  tmp_df <- crs_reshape_dy(crs_tmp, channel_codes,dempurposecodes)
  crs_by_types <- rbind(crs_by_types, tmp_df)
}

```

```{r}
crs_by_types$RecipientName <- ifelse(crs_by_types$RecipientCode == 247, 'Cote dIvoire',crs_by_types$RecipientName)
crs_by_types$new.code <- countrycode(crs_by_types$RecipientName, origin = 'country.name', destination = 'iso3n')
crs_by_types$new.code <- ifelse(crs_by_types$RecipientCode == 247, 384, crs_by_types$new.code) #Cote d'Ivoire
crs_by_types$new.code <- ifelse(crs_by_types$RecipientCode == 860, 583, crs_by_types$new.code) #Federated States of Micronesia
#crs_by_types$new.code <- ifelse(crs_by_types$RecipientCode == 63, 345, crs_by_types$new.code) #Serbia

working <- crs_by_types %>%
  filter(!is.na(Year)&!is.na(new.code)) %>%
  filter(!is.infinite(ngo_total)|!is.infinite(gov_d_total)|!is.infinite(gov_r_total)|!is.infinite(gov_o_total)|!is.infinite(corp_total)|!is.infinite(igo_total)|!is.infinite(other_total))

working$DonorCode <- countrycode(working$DonorName, origin = "country.name", destination = "iso3n")
working$RecipientCode <- countrycode(working$RecipientName, origin = "country.name", destination = "iso3n")
working$RecipientCode[is.na(working$RecipientCode)] <- 583

working$lead_year <- working$Year + 1
working <- merge(working, vdem, by.x = c('lead_year','RecipientCode'),by.y = c('year','RecipientCode'))
working <- merge(working, lagvdem, by.x = c('Year','RecipientCode'),by.y = c('year','RecipientCode'))
working$DyadName <- paste(working$DonorName,working$RecipientName,sep = '-')
working <- merge(working, controls, by.x = c('Year','RecipientCode'), by.y = c('year','RecipientCode'), all.x = TRUE)

working <- merge(working,fdi_d,by.x = c("DonorCode","Year"), by.y = c("iso3n","year"))


working <- working %>%
  filter(!is.na(DyadName)) %>% #If everything is done correctly, this should remove no obs.
  filter(COWcode!=99999) %>%
  unique()

```

```{r, message=FALSE, results='asis', warning=FALSE}
working <- working %>%
  filter(!is.na(v2x_polyarchy)&!is.na(v2x_libdem)&!is.na(v2x_partipdem)&!is.na(gov_d_total)&!is.na(gov_r_total)&!is.na(gov_o_total)&!is.na(other_total)&!is.na(ngo_total)&!is.na(igo_total)&!is.na(corp_total)&!is.na(gdp)&!is.na(urban)&!is.na(pop)&!is.na(other_total)&!is.na(lead_year)&!is.na(DyadName))

library(robustHD)
working$v2x_polyarchy <- standardize(working$v2x_polyarchy)
working$v2x_libdem <- standardize(working$v2x_libdem)
working$v2x_partipdem <- standardize(working$v2x_partipdem)
working$v2x_delibdem <- standardize(working$v2x_delibdem)
working$v2x_egaldem <- standardize(working$v2x_egaldem)

working$lagpoly <- standardize(working$lagpoly)
working$laglib <- standardize(working$laglib)
working$lagpartip <- standardize(working$lagpartip)
working$lagdelib <- standardize(working$lagdelib)
working$lagegal <- standardize(working$lagegal)

working$other_total <- log(working$other_total+working$gov_o_total+1)
working$gov_d_total <- log(working$gov_d_total+1)
working$gov_r_total <- log(working$gov_r_total+1)
working$gov_o_total <- log(working$gov_o_total+1)
working$ngo_total <- log(working$ngo_total+1)
working$igo_total <- log(working$igo_total+1)
working$corp_total <- log(working$corp_total+1)

ind.vars.total <- c('gov_d_total','gov_r_total','ngo_total','igo_total','corp_total','other_total')

ind.vars.total.controlled <- c('gov_d_total','gov_r_total','ngo_total','igo_total','corp_total','other_total','log(gdp)','urban','log(pop)','fdi_d','fdi_r')



mod.poly <- plm(as.formula(paste('I(v2x_polyarchy)', paste(c(ind.vars.total.controlled, "lagpoly"), collapse = '+'),sep='~')), model = 'within',index = c('DyadName'), data = working)
mod.lib <- plm(as.formula(paste('I(v2x_libdem)', paste(c(ind.vars.total.controlled, "laglib"), collapse = '+'),sep='~')), model = 'within',index = c('DyadName'), data = working)
mod.partip <- plm(as.formula(paste('I(v2x_partipdem)', paste(c(ind.vars.total.controlled, "lagpartip"), collapse = '+'),sep='~')), model = 'within',index = c('DyadName'), data = working)


stargazer(mod.poly,mod.lib,mod.partip, colnames = FALSE,dep.var.labels = c('Electoral','Liberal','Participatory'), title = 'Main Results', model.numbers = FALSE, covariate.labels = c('Donor Gov','Target Gov','NGO','IGO','Corporation','Other','log(GDP)','Urban','log(Population)'), font.size = 'small', column.sep.width = '1pt', header = FALSE)


mod.poly2 <- tidy(mod.poly) %>%
  filter(term == "gov_d_total" | term == 'gov_r_total' | term == 'ngo_total' | term == 'igo_total' | term == 'corp_total' | term == 'other_total') %>%
  mutate(model = "Polarchy")
mod.lib2 <- tidy(mod.lib) %>%
  filter(term == "gov_d_total" | term == 'gov_r_total' | term == 'ngo_total' | term == 'igo_total' | term == 'corp_total' | term == 'other_total') %>%
  mutate(model = "Liberal")
mod.partip2 <- tidy(mod.partip) %>%
  filter(term == "gov_d_total" | term == 'gov_r_total' | term == 'ngo_total' | term == 'igo_total' | term == 'corp_total' | term == 'other_total') %>%
  mutate(model = "Participatory")



all_mods <- rbind(mod.poly2, mod.lib2, mod.partip2)

dwplot(all_mods) %>%
  relabel_predictors(c('gov_d_total' = "Donor Gov",                       
                      'gov_r_total' = "Target Gov", 
                      'ngo_total' = "NGO", 
                      'igo_total' = "IGO", 
                      'corp_total' = "Corporations", 
                      'other_total' = "Other")) +
     theme_bw() + xlab("Coefficient Estimate") + ylab("") +
     geom_vline(xintercept = 0, colour = "grey60", linetype = 2) +
     ggtitle("Main Results") + 
     scale_color_discrete(name = "Dem Variable", labels = c('Electoral','Liberal','Participatory')) 


tests.poly <- coef_tests(mod.poly)
tests.lib <- coef_tests(mod.lib)
tests.partip <- coef_tests(mod.partip)
tests.poly$Model <- "Electoral"
tests.lib$Model <- "Liberal"
tests.partip$Model <- "Participatory"

all.tests <- rbind(tests.poly, tests.lib, tests.partip)


p1 <- ggplot(all.tests, aes(pvals, tests, color = Model)) + labs(title = "Coefficient Raw Tests") + geom_vline(xintercept=.05) + geom_point() + xlim(0,1)
p2 <- ggplot(all.tests, aes(adjustedholm, tests, color = Model)) + geom_vline(xintercept=.05) + geom_point() + labs(title = "Coefficient Holm Corrected Tests") + xlim(0,1)


grid.arrange(p1,p2)


stargazer(coef_tests(mod.poly), summary = FALSE, header = FALSE)
stargazer(coef_tests(mod.lib), summary = FALSE, header = FALSE)
stargazer(coef_tests(mod.partip), summary = FALSE, header = FALSE)
```

\clearpage

##Appendix C8: Effect of Narrow Dem Aid Coding on Democratization

```{r, message = FALSE}
#Importing channel codes
modified_crs_channel_codes <- read_delim("new_channel_codes.csv",",", escape_double = FALSE, trim_ws = TRUE)

#selecting and renaming as necessary
channel_codes <- modified_crs_channel_codes %>%
  select(`Channel ID`, ch_type,ch_identity) %>%
  rename(code = `Channel ID`)
rm(modified_crs_channel_codes)
#turning into factors
channel_codes$ch_type <- as.factor(channel_codes$ch_type)
channel_codes$ch_identity <- as.factor(channel_codes$ch_identity)

#Importing dem purpose codes. Right now these are the "loose" codings. More narrow options exist in dempurposecodes,csv
dempurposecodes <- read_csv("dempurposecodes_narrow.csv")
dempurposecodes <- dempurposecodes %>%
  filter(dem_purpose==1)%>%
  select(PurposeCode)
```


```{r}
#This is a function that takes a by year crs_data set, a set of channel codes, and a set of dem purpose codes. It removes unneeded variables and filters out NAs. It then recodes projects with our channel codes which are broader than the original ones. It also gets rid of observations that are not in our set of dem_purpose codes. Finally it reshapes the data a bit to poop out a data frame with observations that are RECIPIENT-YEAR. Variables include the total amount of aid overall and by each channel type. Percentages are also caculated by each channel type.

crs_reshape_dy <- function(crs_data, ch_codes, dempurposecodes){
  
  #This chunk selects necessary variables (donor,recipient, channel, purpose and disbursement) and filters
  #out unwanted donors, recipients and obs with missing channel codes.
  crs_data <- crs_data %>%
    select(Year,RecipientCode,RecipientName,DonorCode,DonorName,
           usd_disbursement,ChannelCode,PurposeCode) %>%
    na.omit() %>%
    filter(!(RecipientCode %in% c(88,89,189,289,489,689,389,380,298,619,798,889,789,679,498,9998,589))) %>%
    filter(PurposeCode %in% dempurposecodes$PurposeCode) %>%
    filter(DonorCode %in% c(1,2,3,4,5,6,7,8,9,10,11,12,13,18,20,21,22,40,50,61,68,69,75,76,301,302,701,742,801,820,82,83,84,358,55,546)) %>%
    filter(!is.na(ChannelCode))
  #merge with channelcodes
  crs_data <- merge(crs_data, channel_codes, by.x = 'ChannelCode', by.y = 'code', all.x = TRUE)
  #counts and aid totals for all types
  crs_data <- crs_data %>%
    group_by(Year,DonorCode,RecipientCode) %>%
    add_count(sort = TRUE) %>%
    mutate(total_disbursement = sum(usd_disbursement, na.rm = TRUE)) %>%
    ungroup()
  
  crs_data$ch_type2 = ifelse(crs_data$ch_type == 'government'&crs_data$ch_identity == 'donor','government_donor', ifelse(crs_data$ch_type == 'government'&crs_data$ch_identity == 'recipient','government_recipient', ifelse(crs_data$ch_type == 'government'&(crs_data$ch_identity == 'other'|crs_data$ch_identity == 'thirdparty'),'government_other',ifelse(crs_data$ch_type == 'publicprivate'|crs_data$ch_type == 'corporation','corporation',ifelse(crs_data$ch_type == 'network'|crs_data$ch_type == 'edu'|crs_data$ch_type=='ngo','ngo', ifelse(crs_data$ch_type == 'igo', 'igo', ifelse(crs_data$ch_type == 'other', 'other',crs_data$ch_type)))))))
  crs_data$ch_type <- crs_data$ch_type2
  
  #This giant block splits it up by type and subtype-identity. 
  crs_data2 <- crs_data %>%
    group_by(Year,RecipientCode,DonorCode,ch_type) %>%
    mutate(
      gov_d_total = ifelse(ch_type == 'government_donor',sum(usd_disbursement,na.rm = TRUE),0),
      gov_r_total = ifelse(ch_type == 'government_recipient',sum(usd_disbursement,na.rm = TRUE),0),
      gov_o_total = ifelse(ch_type == 'government_other',sum(usd_disbursement,na.rm = TRUE),0),
      gov_total = ifelse(ch_type == 'government',sum(usd_disbursement, na.rm = TRUE),0),
      corp_total = ifelse(ch_type == 'corporation',sum(usd_disbursement,na.rm = TRUE),0),
      ngo_total = ifelse(ch_type == 'ngo',sum(usd_disbursement,na.rm = TRUE),0),
      igo_total = ifelse(ch_type == 'igo',sum(usd_disbursement,na.rm = TRUE),0),
      other_total = ifelse(ch_type == 'other',sum(usd_disbursement,na.rm = TRUE),0)
    ) %>%
    ungroup() %>%
    group_by(Year,DonorCode,RecipientCode) %>%
    select(Year,RecipientCode,RecipientName,DonorCode,DonorName,n,total_disbursement,gov_total,gov_d_total,gov_r_total,gov_o_total,corp_total,ngo_total,igo_total,other_total) %>%
    mutate(
      gov_d_total = max(round(gov_d_total,6), na.rm = TRUE),
      gov_r_total = max(round(gov_r_total,6), na.rm = TRUE),
      gov_o_total = max(round(gov_o_total,6), na.rm = TRUE),
      gov_total = max(round(gov_d_total+gov_r_total+gov_o_total,6), na.rm = TRUE),
      corp_total = max(round(corp_total,6), na.rm = TRUE),
      ngo_total = max(round(ngo_total,6), na.rm = TRUE),
      igo_total = max(round(igo_total,6), na.rm = TRUE),
      other_total = max(round(other_total,6), na.rm = TRUE)
    ) %>%
    unique() %>%
    ungroup() 
  #Return the data frame.
  crs_data2
}
```

```{r, message=FALSE}
#This chunk imports and merges all of the yearly CRS data according to the above function.
#vector of the file name years. Early ones are grouped together. 1973-94 is omitted as it serves as the base case below.
years <- c('1995-99','2000-01','2002-03','2004-05','2006','2007','2008','2009','2010','2011','2012','2013','2014','2015','2016','2017')

#importing and running crs_by_types on the base case
load(file = './CRS 1973-94 data.RData')
crs_by_types <- crs_reshape_dy(crs_tmp,channel_codes,dempurposecodes)

#importing, reshaping and appending each of the CRS data files.
for (i in years){
  filepath = paste0('./CRS ',i,' data.RData')
  load(file = filepath)
  tmp_df <- crs_reshape_dy(crs_tmp, channel_codes,dempurposecodes)
  crs_by_types <- rbind(crs_by_types, tmp_df)
}

```

```{r}
crs_by_types$RecipientName <- ifelse(crs_by_types$RecipientCode == 247, 'Cote dIvoire',crs_by_types$RecipientName)
crs_by_types$new.code <- countrycode(crs_by_types$RecipientName, origin = 'country.name', destination = 'iso3n')
crs_by_types$new.code <- ifelse(crs_by_types$RecipientCode == 247, 384, crs_by_types$new.code) #Cote d'Ivoire
crs_by_types$new.code <- ifelse(crs_by_types$RecipientCode == 860, 583, crs_by_types$new.code) #Federated States of Micronesia
#crs_by_types$new.code <- ifelse(crs_by_types$RecipientCode == 63, 345, crs_by_types$new.code) #Serbia

working <- crs_by_types %>%
  filter(!is.na(Year)&!is.na(new.code)) %>%
  filter(!is.infinite(ngo_total)|!is.infinite(gov_d_total)|!is.infinite(gov_r_total)|!is.infinite(gov_o_total)|!is.infinite(corp_total)|!is.infinite(igo_total)|!is.infinite(other_total))

working$DonorCode <- countrycode(working$DonorName, origin = "country.name", destination = "iso3n")
working$RecipientCode <- countrycode(working$RecipientName, origin = "country.name", destination = "iso3n")
working$RecipientCode[is.na(working$RecipientCode)] <- 583

working$lead_year <- working$Year + 1
working <- merge(working, vdem, by.x = c('lead_year','RecipientCode'),by.y = c('year','RecipientCode'))
working <- merge(working, lagvdem, by.x = c('Year','RecipientCode'),by.y = c('year','RecipientCode'))
working$DyadName <- paste(working$DonorName,working$RecipientName,sep = '-')


working <- merge(working, controls, by.x = c('Year','RecipientCode'), by.y = c('year','RecipientCode'), all.x = TRUE)

working <- merge(working,fdi_d,by.x = c("DonorCode","Year"), by.y = c("iso3n","year"))


working <- working %>%
  filter(!is.na(DyadName)) %>% #If everything is done correctly, this should remove no obs.
  filter(COWcode!=99999) %>%
  unique()

```

```{r, message=FALSE, results='asis', warning=FALSE}
working <- working %>%
  filter(!is.na(v2x_polyarchy)&!is.na(v2x_libdem)&!is.na(v2x_partipdem)&!is.na(gov_d_total)&!is.na(gov_r_total)&!is.na(gov_o_total)&!is.na(other_total)&!is.na(ngo_total)&!is.na(igo_total)&!is.na(corp_total)&!is.na(gdp)&!is.na(urban)&!is.na(pop)&!is.na(other_total)&!is.na(lead_year)&!is.na(DyadName))

library(robustHD)
working$v2x_polyarchy <- standardize(working$v2x_polyarchy)
working$v2x_libdem <- standardize(working$v2x_libdem)
working$v2x_partipdem <- standardize(working$v2x_partipdem)
working$v2x_delibdem <- standardize(working$v2x_delibdem)
working$v2x_egaldem <- standardize(working$v2x_egaldem)

working$lagpoly <- standardize(working$lagpoly)
working$laglib <- standardize(working$laglib)
working$lagpartip <- standardize(working$lagpartip)
working$lagdelib <- standardize(working$lagdelib)
working$lagegal <- standardize(working$lagegal)

working$other_total <- log(working$other_total+working$gov_o_total+1)
working$gov_d_total <- log(working$gov_d_total+1)
working$gov_r_total <- log(working$gov_r_total+1)
working$gov_o_total <- log(working$gov_o_total+1)
working$ngo_total <- log(working$ngo_total+1)
working$igo_total <- log(working$igo_total+1)
working$corp_total <- log(working$corp_total+1)

ind.vars.total <- c('gov_d_total','gov_r_total','ngo_total','igo_total','corp_total','other_total')

ind.vars.total.controlled <- c('gov_d_total','gov_r_total','ngo_total','igo_total','corp_total','other_total','log(gdp)','urban','log(pop)','fdi_d','fdi_r')



mod.poly <- plm(as.formula(paste('I(v2x_polyarchy)', paste(c(ind.vars.total.controlled, "lagpoly"), collapse = '+'),sep='~')), model = 'within',index = c('DyadName'), data = working)
mod.lib <- plm(as.formula(paste('I(v2x_libdem)', paste(c(ind.vars.total.controlled, "laglib"), collapse = '+'),sep='~')), model = 'within',index = c('DyadName'), data = working)
mod.partip <- plm(as.formula(paste('I(v2x_partipdem)', paste(c(ind.vars.total.controlled, "lagpartip"), collapse = '+'),sep='~')), model = 'within',index = c('DyadName'), data = working)


stargazer(mod.poly,mod.lib,mod.partip, colnames = FALSE,dep.var.labels = c('Electoral','Liberal','Participatory'), title = 'Main Results', model.numbers = FALSE, covariate.labels = c('Donor Gov','Target Gov','NGO','IGO','Corporation','Other','log(GDP)','Urban','log(Population)'), font.size = 'small', column.sep.width = '1pt', header = FALSE)

mod.poly2 <- tidy(mod.poly) %>%
  filter(term == "gov_d_total" | term == 'gov_r_total' | term == 'ngo_total' | term == 'igo_total' | term == 'corp_total' | term == 'other_total') %>%
  mutate(model = "Polarchy")
mod.lib2 <- tidy(mod.lib) %>%
  filter(term == "gov_d_total" | term == 'gov_r_total' | term == 'ngo_total' | term == 'igo_total' | term == 'corp_total' | term == 'other_total') %>%
  mutate(model = "Liberal")
mod.partip2 <- tidy(mod.partip) %>%
  filter(term == "gov_d_total" | term == 'gov_r_total' | term == 'ngo_total' | term == 'igo_total' | term == 'corp_total' | term == 'other_total') %>%
  mutate(model = "Participatory")


all_mods <- rbind(mod.poly2, mod.lib2, mod.partip2)

dwplot(all_mods) %>%
  relabel_predictors(c('gov_d_total' = "Donor Gov",                       
                      'gov_r_total' = "Target Gov", 
                      'ngo_total' = "NGO", 
                      'igo_total' = "IGO", 
                      'corp_total' = "Corporations", 
                      'other_total' = "Other")) +
     theme_bw() + xlab("Coefficient Estimate") + ylab("") +
     geom_vline(xintercept = 0, colour = "grey60", linetype = 2) +
     ggtitle("Main Results") + 
     scale_color_discrete(name = "Dem Variable", labels = c('Electoral','Liberal','Participatory')) 

tests.poly <- coef_tests(mod.poly)
tests.lib <- coef_tests(mod.lib)
tests.partip <- coef_tests(mod.partip)
tests.poly$Model <- "Electoral"
tests.lib$Model <- "Liberal"
tests.partip$Model <- "Participatory"

all.tests <- rbind(tests.poly, tests.lib, tests.partip)


p1 <- ggplot(all.tests, aes(pvals, tests, color = Model)) + labs(title = "Coefficient Raw Tests") + geom_vline(xintercept=.05) + geom_point() + xlim(0,1)
p2 <- ggplot(all.tests, aes(adjustedholm, tests, color = Model)) + geom_vline(xintercept=.05) + geom_point() + labs(title = "Coefficient Holm Corrected Tests") + xlim(0,1)

grid.arrange(p1,p2)


stargazer(coef_tests(mod.poly), summary = FALSE, header = FALSE)
stargazer(coef_tests(mod.lib), summary = FALSE, header = FALSE)
stargazer(coef_tests(mod.partip), summary = FALSE, header = FALSE)
```

\clearpage


##Appendix D1: Narrow Codings of Democracy

```{r}
library(readr)
library(readxl)
library(tidyverse)
library(stargazer)
library(kableExtra)
all_DAC_codes <- read_excel("all_DAC_codes.xls", col_names = FALSE)
```

```{r}
dempurposecodes3 <- read_csv("dempurposecodes_narrow.csv")
narrow <- merge(all_DAC_codes, dempurposecodes3, by.x = '...3', by.y = 'PurposeCode') %>%
  filter(dem_purpose == 1) %>%
  select(Category =...1, Description = ...2)


kable(narrow, longtable = TRUE) %>%
  kable_styling(full_width = FALSE, latex_options = c("hold_position", "repeat_header")) %>%
  column_spec(1, width = '10em', bold = T, border_right = T) %>%
  column_spec(2, width = "30em")

```

\clearpage

##Appendix D2: Broad Codings of Democracy

```{r}
dempurposecodes2 <- read_csv("dempurposecodes_medium.csv")
broad <- merge(all_DAC_codes, dempurposecodes2, by.x = '...3', by.y = 'PurposeCode') %>%
  filter(dem_purpose == 1) %>%
  select(Category =...1, Description = ...2)

kable(broad, longtable = TRUE) %>%
  kable_styling(full_width = FALSE, latex_options = c("hold_position", "repeat_header")) %>%
  column_spec(1, width = '10em', bold = T, border_right = T) %>%
  column_spec(2, width = "30em")
```